<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Space</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #f8d7da;
            --secondary-lavender: #e7d3f4;
            --soft-peach: #ffeaa7;
            --mint-green: #d1f2eb;
            --soft-blue: #d4f1f4;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --white: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
            --error: #e74c3c;
            --success: #27ae60;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--primary-pink), var(--soft-blue));
            min-height: 100vh;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--text-light);
            border-top: 5px solid var(--primary-pink);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Help Button */
        .help-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px var(--shadow);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .help-button:hover {
            transform: scale(1.1);
            background: var(--soft-peach);
        }

        .help-button svg {
            width: 24px;
            height: 24px;
        }

        /* Tutorial Modal */
        .tutorial-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
        }

        .tutorial-modal.active {
            display: flex;
        }

        .tutorial-content {
            background: var(--white);
            border-radius: 25px;
            padding: 3rem;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .tutorial-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .tutorial-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tutorial-step.active {
            display: block;
        }

        .tutorial-step h2 {
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .tutorial-step p {
            margin-bottom: 1rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .tutorial-step ol, .tutorial-step ul {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        .tutorial-step li {
            margin-bottom: 0.8rem;
            color: var(--text-light);
        }

        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .code-snippet {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        /* Auth Screen */
        .auth-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .auth-card {
            background: var(--white);
            border-radius: 25px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 20px 60px var(--shadow);
            max-width: 600px;
            width: 100%;
        }

        .auth-card h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-pink), var(--secondary-lavender));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-card p {
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .auth-options {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .btn {
            background: var(--secondary-lavender);
            color: var(--text-dark);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: var(--primary-pink);
            transform: translateY(-2px);
        }

        .btn.primary {
            background: var(--primary-pink);
        }

        .btn.primary:hover {
            background: var(--secondary-lavender);
        }

        .btn.secondary {
            background: var(--soft-blue);
        }

        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        .alert.error {
            background: #ffeaea;
            color: var(--error);
            border: 1px solid var(--error);
        }

        .alert.success {
            background: #eafaf1;
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px var(--shadow);
            display: none;
        }

        nav.active {
            display: block;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu li {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-menu li:hover, .nav-menu li.active {
            background: var(--secondary-lavender);
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .room-info {
            background: var(--mint-green);
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .exit-room-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .exit-room-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
            min-height: 100vh;
            display: none;
        }

        .container.active {
            display: block;
        }

        /* Page Sections */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px var(--shadow);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--primary-pink);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: var(--text-light);
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 10px 30px var(--shadow);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            margin-bottom: 1rem;
            color: var(--text-dark);
            font-size: 1.8rem;
        }

        /* Content items */
        .content-item {
            background: var(--white);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 5px 20px var(--shadow);
        }

        .content-item h4 {
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .content-item .meta {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .content-item img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 1rem;
        }

        /* Image upload */
        .image-upload {
            border: 2px dashed var(--text-light);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
        }

        .image-upload:hover {
            border-color: var(--primary-pink);
            background: rgba(248, 215, 218, 0.1);
        }

        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin-top: 1rem;
        }

        /* Chat */
        .chat-container {
            height: 400px;
            background: var(--white);
            border-radius: 20px;
            padding: 1rem;
            margin-bottom: 1rem;
            overflow-y: auto;
            box-shadow: inset 0 2px 10px var(--shadow);
        }

        .chat-message {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 15px;
            max-width: 70%;
        }

        .message-sent {
            background: var(--primary-pink);
            margin-left: auto;
            text-align: right;
        }

        .message-received {
            background: var(--soft-blue);
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 25px;
            background: var(--white);
            box-shadow: 0 2px 10px var(--shadow);
            font-size: 1rem;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                flex-wrap: wrap;
                gap: 0.5rem;
                font-size: 0.9rem;
            }

            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }

            .container {
                padding: 150px 1rem 1rem;
            }

            .auth-options {
                flex-direction: column;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Help Button -->
    <div id="helpButton" class="help-button" onclick="showTutorial()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="tutorial-modal">
        <div class="tutorial-content">
            <button class="tutorial-close" onclick="closeTutorial()">√ó</button>
            
            <!-- Tutorial Step 1: Welcome -->
            <div class="tutorial-step active" data-step="1">
                <h2>Welcome to Our Space! üíï</h2>
                <p>Our Space is a private sanctuary for couples to connect, share memories, and stay close no matter the distance.</p>
                <h3>What can you do here?</h3>
                <ul>
                    <li>üì∏ Save and share precious memories with photos</li>
                    <li>üîó Bookmark special links together</li>
                    <li>üìù Write sweet notes to each other</li>
                    <li>üí¨ Chat privately in real-time</li>
                    <li>üìä Track your shared moments on the dashboard</li>
                </ul>
                <div class="tutorial-navigation">
                    <div></div>
                    <button class="btn primary" onclick="nextTutorialStep()">Next</button>
                </div>
            </div>

            <!-- Tutorial Step 2: GitHub Setup -->
            <div class="tutorial-step" data-step="2">
                <h2>Setting Up Your GitHub Storage</h2>
                <p>Our Space uses GitHub to store your data securely. Don't worry, it's free and easy!</p>
                
                <h3>Step 1: Create a GitHub Account</h3>
                <ol>
                    <li>Go to <a href="https://github.com/signup" target="_blank">github.com/signup</a></li>
                    <li>Enter your email and create a password</li>
                    <li>Choose a username (this will be needed later)</li>
                    <li>Verify your email address</li>
                </ol>
                
                <div class="tutorial-navigation">
                    <button class="btn" onclick="prevTutorialStep()">Back</button>
                    <button class="btn primary" onclick="nextTutorialStep()">Next</button>
                </div>
            </div>

            <!-- Tutorial Step 3: Create Repository -->
            <div class="tutorial-step" data-step="3">
                <h2>Create Your Repository</h2>
                <p>A repository is like a folder where all your Our Space data will be stored.</p>
                
                <h3>Steps:</h3>
                <ol>
                    <li>Go to <a href="https://github.com/new" target="_blank">github.com/new</a></li>
                    <li>Name your repository (e.g., "our-space-data")</li>
                    <li>Choose "Public" or "Private" (we recommend Private)</li>
                    <li>Check "Add a README file"</li>
                    <li>Click "Create repository"</li>
                    <li>Click "Add file" ‚Üí "Create new file"</li>
                    <li>Name it <code>master.txt</code> and click "Commit new file"</li>
                </ol>
                
                <p><strong>Remember:</strong> Your repository name will be in the format: <code>username/repository-name</code></p>
                
                <div class="tutorial-navigation">
                    <button class="btn" onclick="prevTutorialStep()">Back</button>
                    <button class="btn primary" onclick="nextTutorialStep()">Next</button>
                </div>
            </div>

            <!-- Tutorial Step 4: Personal Access Token -->
            <div class="tutorial-step" data-step="4">
                <h2>Generate Personal Access Token</h2>
                <p>This token allows Our Space to save data to your GitHub repository.</p>
                
                <h3>Steps:</h3>
                <ol>
                    <li>Go to <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></li>
                    <li>Click "Generate new token" ‚Üí "Generate new token (classic)"</li>
                    <li>Give it a name like "Our Space App"</li>
                    <li>Set expiration to "No expiration" (or your preference)</li>
                    <li>Select these permissions:
                        <ul>
                            <li>‚úì <strong>repo</strong> (Full control of private repositories)</li>
                        </ul>
                    </li>
                    <li>Scroll down and click "Generate token"</li>
                    <li><strong>Important:</strong> Copy the token immediately! You won't be able to see it again</li>
                </ol>
                
                <p style="color: var(--error); font-weight: bold;">‚ö†Ô∏è Keep your token secret! Don't share it with anyone except your partner.</p>
                
                <div class="tutorial-navigation">
                    <button class="btn" onclick="prevTutorialStep()">Back</button>
                    <button class="btn primary" onclick="nextTutorialStep()">Next</button>
                </div>
            </div>

            <!-- Tutorial Step 5: Ready to Start -->
            <div class="tutorial-step" data-step="5">
                <h2>You're All Set! üéâ</h2>
                <p>Now you're ready to create or join a room!</p>
                
                <h3>Creating a Room:</h3>
                <ul>
                    <li>Choose "Create Room"</li>
                    <li>Enter your GitHub repository and token</li>
                    <li>Share the generated room code with your partner</li>
                </ul>
                
                <h3>Joining a Room:</h3>
                <ul>
                    <li>Choose "Join Room"</li>
                    <li>Enter the SAME GitHub repository and token as your partner</li>
                    <li>Enter the room code they shared with you</li>
                </ul>
                
                <p><strong>Important:</strong> Both partners must use the same GitHub repository and token to access the same room!</p>
                
                <div class="tutorial-navigation">
                    <button class="btn" onclick="prevTutorialStep()">Back</button>
                    <button class="btn primary" onclick="closeTutorial()">Get Started!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-card">
            <h1>Our Space üíï</h1>
            <p>A private sanctuary for couples to connect, share memories, and stay close.</p>
            
            <!-- Initial Choice -->
            <div id="initialChoice">
                <div class="auth-options">
                    <button class="btn primary" onclick="showCreateRoomForm()">Create Room</button>
                    <button class="btn secondary" onclick="showJoinRoomForm()">Join Room</button>
                </div>
            </div>

            <!-- Create Room Form -->
            <div id="createRoomForm" class="hidden">
                <h2 style="margin-bottom: 1.5rem;">Create Your Room</h2>
                
                <div class="form-group">
                    <label for="createName">Your Name</label>
                    <input type="text" id="createName" placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label for="createRepo">GitHub Repository (username/repo-name)</label>
                    <input type="text" id="createRepo" placeholder="e.g., yourusername/our-space-data">
                </div>
                
                <div class="form-group">
                    <label for="createToken">Personal Access Token</label>
                    <input type="password" id="createToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                </div>
                
                <div id="createAlert"></div>
                
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn" onclick="backToChoice()">Back</button>
                    <button class="btn primary" onclick="createRoom()">Create Room</button>
                </div>
            </div>

            <!-- Join Room Form -->
            <div id="joinRoomForm" class="hidden">
                <h2 style="margin-bottom: 1.5rem;">Join Existing Room</h2>
                
                <div class="form-group">
                    <label for="joinName">Your Name</label>
                    <input type="text" id="joinName" placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label for="joinRepo">GitHub Repository (same as your partner)</label>
                    <input type="text" id="joinRepo" placeholder="e.g., yourusername/our-space-data">
                </div>
                
                <div class="form-group">
                    <label for="joinToken">Personal Access Token (same as your partner)</label>
                    <input type="password" id="joinToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                </div>
                
                <div class="form-group">
                    <label for="joinRoomCode">Room Code</label>
                    <input type="text" id="joinRoomCode" placeholder="Enter 6-character code" maxlength="6" style="text-transform: uppercase;">
                </div>
                
                <div id="joinAlert"></div>
                
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn" onclick="backToChoice()">Back</button>
                    <button class="btn primary" onclick="joinRoom()">Join Room</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav id="mainNav">
        <div class="nav-content">
            <ul class="nav-menu">
                <li class="nav-item active" data-page="home">üè† Dashboard</li>
                <li class="nav-item" data-page="memories">üì∏ Memories</li>
                <li class="nav-item" data-page="links">üîó Links</li>
                <li class="nav-item" data-page="notes">üìù Notes</li>
                <li class="nav-item" data-page="chat">üí¨ Chat</li>
            </ul>
            <div class="user-info">
                <div id="roomInfoDisplay" class="room-info"></div>
                <span id="userName"></span>
                <button class="exit-room-btn" onclick="exitRoom()">Exit Room</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div id="mainContainer" class="container">
        <!-- Dashboard Page -->
        <div id="home" class="page active">
            <div class="card">
                <h2>Welcome to Our Space üíï</h2>
                <p id="welcomeMessage">Your shared sanctuary for memories and moments</p>
            </div>

            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3 id="memoriesCount">0</h3>
                    <p>Precious Memories</p>
                </div>
                <div class="stat-card">
                    <h3 id="notesCount">0</h3>
                    <p>Sweet Notes</p>
                </div>
                <div class="stat-card">
                    <h3 id="linksCount">0</h3>
                    <p>Shared Links</p>
                </div>
                <div class="stat-card">
                    <h3 id="messagesCount">0</h3>
                    <p>Messages Exchanged</p>
                </div>
            </div>

            <div class="card">
                <h2>Quick Actions</h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                    <button class="btn" onclick="showPage('memories')">Add Memory</button>
                    <button class="btn" onclick="showPage('notes')">Write Note</button>
                    <button class="btn" onclick="showPage('links')">Save Link</button>
                    <button class="btn" onclick="showPage('chat')">Start Chat</button>
                </div>
            </div>

            <div class="card">
                <h2>Recent Activity</h2>
                <div id="recentActivity" class="empty-state">
                    <p>No activity yet. Start creating memories together!</p>
                </div>
            </div>
        </div>

        <!-- Memories Page -->
        <div id="memories" class="page">
            <div class="card">
                <h2>Our Memories üì∏</h2>
                
                <div class="form-group">
                    <label for="memoryTitle">Memory Title</label>
                    <input type="text" id="memoryTitle" placeholder="Enter memory title">
                </div>
                
                <div class="form-group">
                    <label for="memoryDescription">Description</label>
                    <textarea id="memoryDescription" placeholder="Describe this special moment..." rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="memoryDate">Date</label>
                    <input type="date" id="memoryDate">
                </div>
                
                <div class="form-group">
                    <label>Add Photo (Optional)</label>
                    <div class="image-upload" onclick="document.getElementById('memoryImage').click()">
                        <p>üì∑ Click to upload a photo</p>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Maximum 5MB</p>
                    </div>
                    <input type="file" id="memoryImage" accept="image/*" style="display: none;" onchange="previewMemoryImage(this)">
                    <img id="memoryImagePreview" class="image-preview hidden">
                </div>
                
                <button class="btn primary" onclick="addMemory()">Add Memory</button>
            </div>

            <div id="memoriesContainer"></div>
        </div>

        <!-- Links Page -->
        <div id="links" class="page">
            <div class="card">
                <h2>Our Links üîó</h2>
                
                <div class="form-group">
                    <label for="linkTitle">Link Title</label>
                    <input type="text" id="linkTitle" placeholder="Enter link title">
                </div>
                
                <div class="form-group">
                    <label for="linkUrl">URL</label>
                    <input type="url" id="linkUrl" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label for="linkDescription">Description</label>
                    <textarea id="linkDescription" placeholder="Why is this link special?" rows="3"></textarea>
                </div>
                
                <button class="btn primary" onclick="addLink()">Save Link</button>
            </div>

            <div id="linksContainer"></div>
        </div>

        <!-- Notes Page -->
        <div id="notes" class="page">
            <div class="card">
                <h2>Our Notes üìù</h2>
                
                <div class="form-group">
                    <label for="noteTitle">Note Title</label>
                    <input type="text" id="noteTitle" placeholder="Enter note title">
                </div>
                
                <div class="form-group">
                    <label for="noteContent">Message</label>
                    <textarea id="noteContent" placeholder="Write your sweet message..." rows="5"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Add Image (Optional)</label>
                    <div class="image-upload" onclick="document.getElementById('noteImage').click()">
                        <p>üì∑ Click to upload an image</p>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Maximum 5MB</p>
                    </div>
                    <input type="file" id="noteImage" accept="image/*" style="display: none;" onchange="previewNoteImage(this)">
                    <img id="noteImagePreview" class="image-preview hidden">
                </div>
                
                <button class="btn primary" onclick="addNote()">Save Note</button>
            </div>

            <div id="notesContainer"></div>
        </div>

        <!-- Chat Page -->
        <div id="chat" class="page">
            <div class="card">
                <h2>Private Chat üí¨</h2>
                <div class="chat-container" id="chatContainer"></div>
                
                <div class="chat-input-container">
                    <input type="text" class="chat-input" placeholder="Type your message..." id="messageInput">
                    <button class="btn primary" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        let config = {
            githubRepo: '',
            githubToken: '',
            masterFile: 'master.txt',
            maxFileSize: 100 * 1024 * 1024 // 100MB limit per file
        };

        // Global variables
        let currentUser = null;
        let currentRoom = null;
        let roomData = {};
        let currentTutorialStep = 1;
        let dataFilesList = [];
        let isNewUser = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkIfNewUser();
            setupEventListeners();
        });

        // Check if user is new
        function checkIfNewUser() {
            const hasVisited = window.localStorage.getItem('hasVisited');
            if (!hasVisited) {
                isNewUser = true;
                window.localStorage.setItem('hasVisited', 'true');
                setTimeout(() => showTutorial(), 500);
            }
            checkAuthState();
        }

        // Tutorial functions
        function showTutorial() {
            document.getElementById('tutorialModal').classList.add('active');
            currentTutorialStep = 1;
            showTutorialStep(1);
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').classList.remove('active');
        }

        function showTutorialStep(step) {
            document.querySelectorAll('.tutorial-step').forEach(s => s.classList.remove('active'));
            document.querySelector(`.tutorial-step[data-step="${step}"]`).classList.add('active');
        }

        function nextTutorialStep() {
            if (currentTutorialStep < 5) {
                currentTutorialStep++;
                showTutorialStep(currentTutorialStep);
            }
        }

        function prevTutorialStep() {
            if (currentTutorialStep > 1) {
                currentTutorialStep--;
                showTutorialStep(currentTutorialStep);
            }
        }

        // Auth functions
        function checkAuthState() {
            const savedUser = window.localStorage.getItem('currentUser');
            const savedRoom = window.localStorage.getItem('currentRoom');
            const savedConfig = window.localStorage.getItem('githubConfig');
            
            if (savedUser && savedRoom && savedConfig) {
                currentUser = JSON.parse(savedUser);
                currentRoom = savedRoom;
                config = { ...config, ...JSON.parse(savedConfig) };
                loadRoomData();
            }
        }

        function showCreateRoomForm() {
            document.getElementById('initialChoice').classList.add('hidden');
            document.getElementById('createRoomForm').classList.remove('hidden');
        }

        function showJoinRoomForm() {
            document.getElementById('initialChoice').classList.add('hidden');
            document.getElementById('joinRoomForm').classList.remove('hidden');
        }

        function backToChoice() {
            document.getElementById('createRoomForm').classList.add('hidden');
            document.getElementById('joinRoomForm').classList.add('hidden');
            document.getElementById('initialChoice').classList.remove('hidden');
        }

        // GitHub functions
        async function testGitHubConnection() {
            const response = await fetch(`https://api.github.com/repos/${config.githubRepo}`, {
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!response.ok) {
                throw new Error('Cannot access repository');
            }

            // Check if master file exists
            const masterResponse = await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${config.masterFile}`, {
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            // If master file doesn't exist, create it
            if (masterResponse.status === 404) {
                await createMasterFile();
            }
        }

        async function createMasterFile() {
            const content = btoa(JSON.stringify({
                version: '1.0',
                files: [],
                created: new Date().toISOString()
            }));
            
            await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${config.masterFile}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Initialize Our Space master file',
                    content: content
                })
            });
        }

        async function loadMasterFile() {
            const response = await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${config.masterFile}`, {
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                const content = JSON.parse(atob(data.content));
                dataFilesList = content.files || [];
                return data.sha;
            }
            return null;
        }

        async function updateMasterFile(files) {
            const masterSha = await loadMasterFile();
            
            const content = btoa(JSON.stringify({
                version: '1.0',
                files: files,
                updated: new Date().toISOString()
            }));

            await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${config.masterFile}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Update master file',
                    content: content,
                    sha: masterSha
                })
            });
        }

        async function loadAllRoomData() {
            await loadMasterFile();
            
            if (dataFilesList.length === 0) {
                return {};
            }

            let allRooms = {};
            
            for (const fileName of dataFilesList) {
                try {
                    const response = await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${fileName}`, {
                        headers: {
                            'Authorization': `token ${config.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const content = atob(data.content);
                        const rooms = JSON.parse(content);
                        allRooms = { ...allRooms, ...rooms };
                    }
                } catch (error) {
                    console.error(`Error loading ${fileName}:`, error);
                }
            }

            return allRooms;
        }

        async function saveRoomData() {
            if (!currentRoom || !roomData) return;

            showLoading(true);

            try {
                // Load all existing rooms
                let allRooms = await loadAllRoomData();
                allRooms[currentRoom] = roomData;

                // Calculate total size
                const dataString = JSON.stringify(allRooms);
                const dataSize = new Blob([dataString]).size;

                // If size exceeds limit, split into multiple files
                if (dataSize > config.maxFileSize) {
                    await splitAndSaveData(allRooms);
                } else {
                    // Save to first file or create new one
                    const fileName = dataFilesList.length > 0 ? dataFilesList[0] : `roomdata1.txt`;
                    await saveToFile(fileName, allRooms);
                    
                    if (dataFilesList.length === 0) {
                        dataFilesList.push(fileName);
                        await updateMasterFile(dataFilesList);
                    }
                }

                showLoading(false);
            } catch (error) {
                showLoading(false);
                showAlert('Failed to save data', 'error');
                console.error('Save error:', error);
            }
        }

        async function splitAndSaveData(allRooms) {
            const roomEntries = Object.entries(allRooms);
            let currentFileData = {};
            let currentSize = 0;
            let fileIndex = 1;
            let newFilesList = [];

            for (const [roomCode, data] of roomEntries) {
                const entryString = JSON.stringify({ [roomCode]: data });
                const entrySize = new Blob([entryString]).size;

                // Check if adding this entry would exceed the limit
                if (currentSize + entrySize > config.maxFileSize && Object.keys(currentFileData).length > 0) {
                    // Save current file
                    const fileName = `roomdata${fileIndex}.txt`;
                    await saveToFile(fileName, currentFileData);
                    newFilesList.push(fileName);
                    
                    // Reset for next file
                    currentFileData = {};
                    currentSize = 0;
                    fileIndex++;
                }

                currentFileData[roomCode] = data;
                currentSize += entrySize;
            }

            // Save remaining data
            if (Object.keys(currentFileData).length > 0) {
                const fileName = `roomdata${fileIndex}.txt`;
                await saveToFile(fileName, currentFileData);
                newFilesList.push(fileName);
            }

            // Update master file with new file list
            dataFilesList = newFilesList;
            await updateMasterFile(dataFilesList);
        }

        async function saveToFile(fileName, data) {
            // Check if file exists
            const checkResponse = await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${fileName}`, {
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            let sha = null;
            if (checkResponse.ok) {
                const fileData = await checkResponse.json();
                sha = fileData.sha;
            }

            const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));

            await fetch(`https://api.github.com/repos/${config.githubRepo}/contents/${fileName}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: sha ? `Update ${fileName}` : `Create ${fileName}`,
                    content: content,
                    sha: sha
                })
            });
        }

        // Room management
        function generateRoomCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        async function createRoom() {
            const name = document.getElementById('createName').value.trim();
            const repo = document.getElementById('createRepo').value.trim();
            const token = document.getElementById('createToken').value.trim();

            if (!name || !repo || !token) {
                showAlert('Please fill in all fields', 'error', 'createAlert');
                return;
            }

            if (!repo.includes('/')) {
                showAlert('Repository must be in format: username/repo-name', 'error', 'createAlert');
                return;
            }

            config.githubRepo = repo;
            config.githubToken = token;

            showLoading(true);

            try {
                await testGitHubConnection();
                
                const roomCode = generateRoomCode();
                const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                currentUser = {
                    id: userId,
                    name: name
                };

                currentRoom = roomCode;

                roomData = {
                    code: roomCode,
                    creator: userId,
                    created: new Date().toISOString(),
                    members: [{
                        id: userId,
                        name: name,
                        joinedAt: new Date().toISOString()
                    }],
                    memories: [],
                    links: [],
                    notes: [],
                    messages: []
                };

                await saveRoomData();

                window.localStorage.setItem('currentUser', JSON.stringify(currentUser));
                window.localStorage.setItem('currentRoom', roomCode);
                window.localStorage.setItem('githubConfig', JSON.stringify(config));

                showAlert(`Room created! Code: ${roomCode}`, 'success', 'createAlert');
                
                setTimeout(() => {
                    showMainApp();
                }, 2000);

            } catch (error) {
                showLoading(false);
                showAlert('Failed to create room. Please check your GitHub credentials.', 'error', 'createAlert');
                console.error('Create room error:', error);
            }
        }

        async function joinRoom() {
            const name = document.getElementById('joinName').value.trim();
            const repo = document.getElementById('joinRepo').value.trim();
            const token = document.getElementById('joinToken').value.trim();
            const roomCode = document.getElementById('joinRoomCode').value.trim().toUpperCase();

            if (!name || !repo || !token || !roomCode) {
                showAlert('Please fill in all fields', 'error', 'joinAlert');
                return;
            }

            config.githubRepo = repo;
            config.githubToken = token;

            showLoading(true);

            try {
                await testGitHubConnection();
                
                const allRooms = await loadAllRoomData();

                if (!allRooms[roomCode]) {
                    showLoading(false);
                    showAlert('Room not found. Please check the code.', 'error', 'joinAlert');
                    return;
                }

                roomData = allRooms[roomCode];

                // Check if user with this name already exists
                const existingUser = roomData.members.find(m => m.name.toLowerCase() === name.toLowerCase());
                
                if (existingUser) {
                    // User rejoining - use existing ID
                    currentUser = {
                        id: existingUser.id,
                        name: existingUser.name
                    };
                } else {
                    // New user joining
                    const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    
                    currentUser = {
                        id: userId,
                        name: name
                    };

                    roomData.members.push({
                        id: userId,
                        name: name,
                        joinedAt: new Date().toISOString()
                    });

                    roomData.messages.push({
                        id: `msg_${Date.now()}`,
                        content: `${name} joined the room`,
                        author: 'system',
                        timestamp: new Date().toISOString(),
                        type: 'system'
                    });

                    await saveRoomData();
                }

                currentRoom = roomCode;

                window.localStorage.setItem('currentUser', JSON.stringify(currentUser));
                window.localStorage.setItem('currentRoom', roomCode);
                window.localStorage.setItem('githubConfig', JSON.stringify(config));

                showAlert('Successfully joined!', 'success', 'joinAlert');
                
                setTimeout(() => {
                    showMainApp();
                }, 1500);

            } catch (error) {
                showLoading(false);
                showAlert('Failed to join room. Please check your credentials and room code.', 'error', 'joinAlert');
                console.error('Join room error:', error);
            }
        }

        async function loadRoomData() {
            showLoading(true);

            try {
                const allRooms = await loadAllRoomData();

                if (allRooms[currentRoom]) {
                    roomData = allRooms[currentRoom];
                    showMainApp();
                } else {
                    showLoading(false);
                    showAlert('Room not found', 'error');
                    window.localStorage.removeItem('currentRoom');
                    location.reload();
                }
            } catch (error) {
                showLoading(false);
                showAlert('Failed to load room data', 'error');
                console.error('Load error:', error);
            }
        }

        async function exitRoom() {
            if (confirm('Are you sure you want to exit? You can rejoin anytime with the room code.')) {
                window.localStorage.removeItem('currentRoom');
                window.localStorage.removeItem('currentUser');
                window.localStorage.removeItem('githubConfig');
                location.reload();
            }
        }

        function showMainApp() {
            showLoading(false);
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainNav').classList.add('active');
            document.getElementById('mainContainer').classList.add('active');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('roomInfoDisplay').textContent = `Room: ${currentRoom}`;
            
            updateUI();
            startPeriodicSync();
        }

        function startPeriodicSync() {
            setInterval(async () => {
                if (currentRoom) {
                    try {
                        const allRooms = await loadAllRoomData();
                        if (allRooms[currentRoom]) {
                            roomData = allRooms[currentRoom];
                            updateUI();
                        }
                    } catch (error) {
                        console.error('Sync error:', error);
                    }
                }
            }, 30000); // Sync every 30 seconds
        }

        // Content functions
        function previewMemoryImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('Image must be less than 5MB', 'error');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('memoryImagePreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function previewNoteImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('Image must be less than 5MB', 'error');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('noteImagePreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        async function addMemory() {
            const title = document.getElementById('memoryTitle').value.trim();
            const description = document.getElementById('memoryDescription').value.trim();
            const date = document.getElementById('memoryDate').value;
            const imageInput = document.getElementById('memoryImage');

            if (!title || !description) {
                showAlert('Please fill in title and description', 'error');
                return;
            }

            let imageData = null;
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                imageData = await new Promise((resolve) => {
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(imageInput.files[0]);
                });
            }

            const memory = {
                id: `memory_${Date.now()}`,
                title,
                description,
                date: date || new Date().toISOString().split('T')[0],
                author: currentUser.name,
                authorId: currentUser.id,
                created: new Date().toISOString(),
                image: imageData
            };

            if (!roomData.memories) roomData.memories = [];
            roomData.memories.unshift(memory);
            
            await saveRoomData();

            document.getElementById('memoryTitle').value = '';
            document.getElementById('memoryDescription').value = '';
            document.getElementById('memoryDate').value = '';
            document.getElementById('memoryImage').value = '';
            document.getElementById('memoryImagePreview').classList.add('hidden');

            updateUI();
            showAlert('Memory added successfully!', 'success');
        }

        async function addLink() {
            const title = document.getElementById('linkTitle').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            const description = document.getElementById('linkDescription').value.trim();

            if (!title || !url) {
                showAlert('Please fill in title and URL', 'error');
                return;
            }

            const link = {
                id: `link_${Date.now()}`,
                title,
                url,
                description,
                author: currentUser.name,
                authorId: currentUser.id,
                created: new Date().toISOString()
            };

            if (!roomData.links) roomData.links = [];
            roomData.links.unshift(link);
            
            await saveRoomData();

            document.getElementById('linkTitle').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkDescription').value = '';

            updateUI();
            showAlert('Link saved successfully!', 'success');
        }

        async function addNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            const imageInput = document.getElementById('noteImage');

            if (!title || !content) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            let imageData = null;
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                imageData = await new Promise((resolve) => {
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(imageInput.files[0]);
                });
            }

            const note = {
                id: `note_${Date.now()}`,
                title,
                content,
                author: currentUser.name,
                authorId: currentUser.id,
                created: new Date().toISOString(),
                image: imageData
            };

            if (!roomData.notes) roomData.notes = [];
            roomData.notes.unshift(note);
            
            await saveRoomData();

            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            document.getElementById('noteImage').value = '';
            document.getElementById('noteImagePreview').classList.add('hidden');

            updateUI();
            showAlert('Note saved successfully!', 'success');
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();

            if (!content) return;

            const message = {
                id: `msg_${Date.now()}`,
                content,
                author: currentUser.name,
                authorId: currentUser.id,
                timestamp: new Date().toISOString(),
                type: 'message'
            };

            if (!roomData.messages) roomData.messages = [];
            roomData.messages.push(message);
            
            await saveRoomData();

            input.value = '';
            updateChatDisplay();
        }

        // UI Update functions
        function updateUI() {
            updateDashboard();
            updateMemoriesDisplay();
            updateLinksDisplay();
            updateNotesDisplay();
            updateChatDisplay();
        }

        function updateDashboard() {
            document.getElementById('memoriesCount').textContent = (roomData.memories || []).length;
            document.getElementById('notesCount').textContent = (roomData.notes || []).length;
            document.getElementById('linksCount').textContent = (roomData.links || []).length;
            document.getElementById('messagesCount').textContent = (roomData.messages || []).filter(m => m.type === 'message').length;

            updateRecentActivity();
        }

        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            const activities = [];

            if (roomData.memories) {
                roomData.memories.slice(0, 3).forEach(m => {
                    activities.push({ text: `${m.author} added memory: "${m.title}"`, time: m.created });
                });
            }

            if (roomData.notes) {
                roomData.notes.slice(0, 3).forEach(n => {
                    activities.push({ text: `${n.author} wrote note: "${n.title}"`, time: n.created });
                });
            }

            if (roomData.links) {
                roomData.links.slice(0, 3).forEach(l => {
                    activities.push({ text: `${l.author} shared: "${l.title}"`, time: l.created });
                });
            }

            if (activities.length === 0) {
                container.innerHTML = '<p class="empty-state">No activity yet. Start creating memories together!</p>';
                return;
            }

            activities.sort((a, b) => new Date(b.time) - new Date(a.time));

            container.innerHTML = activities.slice(0, 5).map(a => 
                `<p style="margin: 0.5rem 0;">üìå ${a.text}</p>`
            ).join('');
        }

        function updateMemoriesDisplay() {
            const container = document.getElementById('memoriesContainer');

            if (!roomData.memories || roomData.memories.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No memories yet</h3><p>Add your first special moment!</p></div>';
                return;
            }

            container.innerHTML = roomData.memories.map(m => `
                <div class="content-item">
                    <h4>${m.title}</h4>
                    <div class="meta">By ${m.author} on ${new Date(m.date).toLocaleDateString()}</div>
                    <p>${m.description}</p>
                    ${m.image ? `<img src="${m.image}" alt="${m.title}">` : ''}
                </div>
            `).join('');
        }

        function updateLinksDisplay() {
            const container = document.getElementById('linksContainer');

            if (!roomData.links || roomData.links.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No links yet</h3><p>Save your first shared link!</p></div>';
                return;
            }

            container.innerHTML = roomData.links.map(l => `
                <div class="content-item">
                    <h4><a href="${l.url}" target="_blank" style="color: var(--primary-pink);">${l.title}</a></h4>
                    <div class="meta">Shared by ${l.author} on ${new Date(l.created).toLocaleDateString()}</div>
                    ${l.description ? `<p>${l.description}</p>` : ''}
                </div>
            `).join('');
        }

        function updateNotesDisplay() {
            const container = document.getElementById('notesContainer');

            if (!roomData.notes || roomData.notes.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No notes yet</h3><p>Write your first sweet message!</p></div>';
                return;
            }

            container.innerHTML = roomData.notes.map(n => `
                <div class="content-item">
                    <h4>${n.title}</h4>
                    <div class="meta">From ${n.author} on ${new Date(n.created).toLocaleDateString()}</div>
                    <p>${n.content}</p>
                    ${n.image ? `<img src="${n.image}" alt="${n.title}">` : ''}
                </div>
            `).join('');
        }

        function updateChatDisplay() {
            const container = document.getElementById('chatContainer');

            if (!roomData.messages || roomData.messages.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No messages yet</h3><p>Start your conversation!</p></div>';
                return;
            }

            container.innerHTML = roomData.messages.map(msg => {
                if (msg.type === 'system') {
                    return `<div style="text-align: center; color: var(--text-light); margin: 1rem 0; font-style: italic;">${msg.content}</div>`;
                }

                const isSent = msg.authorId === currentUser.id;
                return `
                    <div class="chat-message ${isSent ? 'message-sent' : 'message-received'}">
                        <p>${msg.content}</p>
                        <small>${msg.author} - ${new Date(msg.timestamp).toLocaleTimeString()}</small>
                    </div>
                `;
            }).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Utility functions
        function showAlert(message, type, containerId = null) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;

            if (containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                container.appendChild(alert);
            } else {
                document.body.appendChild(alert);
                setTimeout(() => alert.remove(), 5000);
            }
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const targetPage = item.getAttribute('data-page');
                    showPage(targetPage);

                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                });
            });

            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            document.getElementById('joinRoomCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinRoom();
                }
            });

            document.getElementById('joinRoomCode').addEventListener('input', function(e) {
                this.value = this.value.toUpperCase();
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }
    </script>
</body>
</html>
